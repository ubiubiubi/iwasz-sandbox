cmake_minimum_required(VERSION 2.8)
SET (CMAKE_VERBOSE_MAKEFILE OFF) 

PROJECT (i2c-test)
include (stm32f4.cmake)
ADD_DEFINITIONS(-DUSE_STDPERIPH_DRIVER)

INCLUDE_DIRECTORIES("../src/")
AUX_SOURCE_DIRECTORY (../src/ APP_SOURCES)

LIST (APPEND APP_SOURCES "${STM_DIR}/Libraries/CMSIS/ST/STM32F4xx/Source/Templates/TrueSTUDIO/startup_stm32f4xx.s")
LIST (APPEND APP_SOURCES "${STM_DIR}/Libraries/STM32F4xx_StdPeriph_Driver/src/stm32f4xx_rcc.c")
LIST (APPEND APP_SOURCES "${STM_DIR}/Libraries/STM32F4xx_StdPeriph_Driver/src/stm32f4xx_gpio.c")
LIST (APPEND APP_SOURCES "${STM_DIR}/Libraries/STM32F4xx_StdPeriph_Driver/src/stm32f4xx_i2c.c")
LIST (APPEND APP_SOURCES "${STM_DIR}/Libraries/STM32F4xx_StdPeriph_Driver/src/stm32f4xx_usart.c")

ADD_EXECUTABLE(${CMAKE_PROJECT_NAME}.elf ${APP_SOURCES})

ADD_CUSTOM_TARGET(${CMAKE_PROJECT_NAME}.hex ALL DEPENDS ${CMAKE_PROJECT_NAME}.elf COMMAND ${CMAKE_OBJCOPY} -Oihex ${CMAKE_PROJECT_NAME}.elf ${CMAKE_PROJECT_NAME}.hex)
ADD_CUSTOM_TARGET(${CMAKE_PROJECT_NAME}.bin ALL DEPENDS ${CMAKE_PROJECT_NAME}.elf COMMAND ${CMAKE_OBJCOPY} -Obinary ${CMAKE_PROJECT_NAME}.elf ${CMAKE_PROJECT_NAME}.bin)

# st-flash write stm32-cmake-test.bin 0x8000000
